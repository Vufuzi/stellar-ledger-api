<html>
<head>
    <script src="../browser/stellar-ledger-api.js"></script>
    <script src="runScript-browser.js"></script>
    <script>
        var ledgerApi;
        function selectAndRun() {
            var select = document.getElementById('script');
            var script = select.options[select.selectedIndex].text;
            runScript(script);
        }
        function connect() {
            ledgerApi = new StellarLedger.Api(new StellarLedger.comm(3));
            ledgerApi.addDeviceListener(deviceListener);
        }
        function disconnect() {
            ledgerApi.clearDeviceListeners();
        }
        function deviceListener(status, msg) {
            if (status === 'Connected') {
                onConnect();
            } else if (status === 'Timeout') {
                onTimeout();
            } else if (status === 'Error') {
                onError(msg);
            }
        }
        function onTimeout() {
            displayMesage('Connect your Ledger and open the Stellar App');
            setFormDisabled(true);
        }
        function onConnect() {
            displayMesage('Ledger Connected');
            setFormDisabled(false);
        }
        function onError(msg) {
            displayMesage('Error connecting: ' + msg);
            setFormDisabled(true);
        }
        function displayMesage(msg) {
            document.getElementById('msg').innerHTML = msg;
        }
        function setFormDisabled(disabled) {
            document.getElementById('script').disabled = disabled;
            document.getElementById('runScript').disabled = disabled;
        }
    </script>
</head>
<body onload="onTimeout();connect();" onunload="disconnect()">
<div id="msg"></div>
<div id="form">
    <select id="script" disabled>
        <option>testGetPublicKey</option>
        <option>testSignTx</option>
        <option>testSignTxHash</option>
    </select>
    <input id='runScript' type="button" onClick="selectAndRun()" value="run script" disabled>
</div>
</body>
</html>
