<html>
<head>
    <script src="../browser/stellar-ledger-api.js"></script>
    <script src="runScript-browser.js"></script>
    <script>
        function selectAndRun() {
            var select = document.getElementById('script');
            var script = select.options[select.selectedIndex].text;
            runScript(script);
        }
        function connect() {
            StellarLedger.comm.create_async(5).then(function (comm) {
                var api = new StellarLedger.Api(comm);
                api.addDeviceListener(function(status, msg) {
                    if (status === 'Connected') {
                        onConnect();
                    } else if (status === 'Timeout') {
                        onTimeout();
                    } else if (status === 'Asleep') {
                        onAsleep();
                    } else if (status === 'Error') {
                        onError(msg);
                    }
                });
            }).catch(function (err) {
                console.log('Unable to connect with ledger device' + err);
                onError(err);
            });
        }
        function onTimeout() {
            document.getElementById('msg').innerHTML = 'Connect you Ledger and open the Stellar App';
            document.getElementById('script').disabled = true;
            document.getElementById('runScript').disabled = true;
        }
        function onConnect() {
            document.getElementById('msg').innerHTML = 'Ledger Connected';
            document.getElementById('script').disabled = false;
            document.getElementById('runScript').disabled = false;
        }
        function onAsleep() {
            document.getElementById('msg').innerHTML = 'Ledger Asleep';
            document.getElementById('script').disabled = true;
            document.getElementById('runScript').disabled = true;
        }
        function onError(msg) {
            document.getElementById('msg').innerHTML = 'Error connecting: ' + msg;
        }
    </script>
</head>
<body onload="onTimeout();connect();">
<div id="msg"></div>
<div id="form">
    <select id="script" disabled>
        <option>testGetPublicKey</option>
        <option>testSignTx</option>
        <option>testSignTxHash</option>
    </select>
    <input id='runScript' type="button" onClick="selectAndRun()" value="run script" disabled>
</div>
</body>
</html>
